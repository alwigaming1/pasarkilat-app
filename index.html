<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PasarKilat - Aplikasi Kurir</title>
    <link rel="icon" href="https://via.placeholder.com/32">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"> 
</head>
<body>
    <div class="app-container">
        <header class="courier-header">
            <div class="header-main">
                <button class="menu-btn" id="menuBtn">
                    <span class="menu-icon">‚ò∞</span>
                </button>
                <div class="header-left">
                    <div class="logo">PasarKilat</div>
                    <div class="status-indicator">
                        <div class="status-dot online"></div>
                        <span class="status-text">Online</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="balance-display">
                        <span class="balance-label">Saldo:</span>
                        <span class="balance-amount">Rp 185.000</span>
                    </div>
                    <div class="user-avatar">üö¥</div>
                </div>
            </div>
            <div class="status-control">
                <label class="toggle-container">
                    <span class="toggle-label">Mode Aktif</span>
                    <div class="toggle-switch">
                        <input type="checkbox" id="statusToggle" checked>
                        <span class="slider"></span>
                    </div>
                </label>
            </div>
        </header>

        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="user-info">
                    <div class="user-avatar">üö¥</div>
                    <div class="user-details">
                        <div class="user-name">Kurir PasarKilat 001</div>
                        <div class="user-rating">‚≠êÔ∏è 4.9 (1,234 reviews)</div>
                    </div>
                </div>
                <button class="close-sidebar" id="closeSidebar">‚úï</button>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-page="dashboard"><span class="nav-icon">üè†</span><span class="nav-text">Dashboard</span></a>
                <a href="#" class="nav-item" data-page="jobs"><span class="nav-icon">üì¶</span><span class="nav-text">Pesanan Baru</span><span class="nav-badge" id="jobsBadge" style="display:none;">0</span></a>
                <a href="#" class="nav-item" data-page="active-delivery"><span class="nav-icon">üìç</span><span class="nav-text">Pengiriman Aktif</span></a>
                <a href="#" class="nav-item" data-page="earnings"><span class="nav-icon">üí∞</span><span class="nav-text">Penghasilan</span></a>
                <a href="#" class="nav-item" data-page="history"><span class="nav-icon">üìú</span><span class="nav-text">Riwayat</span></a>
                <a href="#" class="nav-item" data-page="performance"><span class="nav-icon">üìà</span><span class="nav-text">Performa</span></a>
            </nav>
            <div class="sidebar-footer">
                <div class="system-status">
                    <div class="status-dot" id="whatsappStatusDot"></div>
                    <span id="whatsappStatusText">WhatsApp: DISCONNECTED</span>
                </div>
                <button class="logout-btn" onclick="showNotification('Simulasi Log Out', 'warning')">üö™ Keluar</button>
            </div>
        </div>
        <div class="overlay" id="overlay"></div>

        <main class="app-pages">
            
            <!-- Dashboard Section -->
            <section id="dashboard" class="page active">
                <div class="main-content">
                    <!-- Welcome Section -->
                    <div class="welcome-section">
                        <div class="welcome-content">
                            <div class="greeting">
                                <h1>Selamat Siang, <span class="user-name">Kurir 001</span>! üëã</h1>
                                <p class="date-display" id="currentDate">Minggu, 15 Desember 2024</p>
                            </div>
                            <div class="weather-info">
                                <div class="weather-icon">‚òÄÔ∏è</div>
                                <div class="weather-details">
                                    <div class="weather-temp">32¬∞C</div>
                                    <div class="weather-location">Jakarta</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="quick-stats-section">
                        <div class="section-title">Ringkasan Hari Ini</div>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-content">
                                    <div class="stat-icon-container">
                                        <span class="stat-icon">‚úÖ</span>
                                    </div>
                                    <div class="stat-details">
                                        <div class="stat-value" id="statsCompleted">12</div>
                                        <div class="stat-label">Selesai</div>
                                    </div>
                                </div>
                                <div class="stat-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 80%"></div>
                                    </div>
                                    <div class="progress-text">80% target</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-content">
                                    <div class="stat-icon-container">
                                        <span class="stat-icon">‚≠ê</span>
                                    </div>
                                    <div class="stat-details">
                                        <div class="stat-value" id="statsRating">4.9</div>
                                        <div class="stat-label">Rating</div>
                                    </div>
                                </div>
                                <div class="rating-stars">
                                    <span class="star">‚òÖ</span>
                                    <span class="star">‚òÖ</span>
                                    <span class="star">‚òÖ</span>
                                    <span class="star">‚òÖ</span>
                                    <span class="star half">‚òÖ</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-content">
                                    <div class="stat-icon-container">
                                        <span class="stat-icon">‚è±Ô∏è</span>
                                    </div>
                                    <div class="stat-details">
                                        <div class="stat-value" id="statsOnlineTime">5h 42m</div>
                                        <div class="stat-label">Waktu Online</div>
                                    </div>
                                </div>
                                <div class="online-indicator">
                                    <div class="pulse-dot"></div>
                                    <span class="online-text">Online</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-content">
                                    <div class="stat-icon-container">
                                        <span class="stat-icon">üí∞</span>
                                    </div>
                                    <div class="stat-details">
                                        <div class="stat-value" id="statsEarnings">Rp 420K</div>
                                        <div class="stat-label">Penghasilan</div>
                                    </div>
                                </div>
                                <div class="earnings-trend">
                                    <span class="trend-up">‚Üë 12%</span>
                                    <span class="trend-text">dari kemarin</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Active Delivery Section -->
                    <div class="delivery-preview-section" id="activeDeliveryCard" style="display:none;">
                        <div class="section-header">
                            <div class="section-title">Pengiriman Aktif</div>
                            <div class="delivery-status">
                                <span class="timer-display" id="deliveryTimer">00:25:18</span>
                                <span class="status-badge on-time">TEPAT WAKTU</span>
                            </div>
                        </div>
                        <div class="delivery-preview-card active">
                            <div class="delivery-header">
                                <div class="delivery-id">#ORD1001</div>
                                <div class="priority-badge urgent">URGENT</div>
                            </div>
                            
                            <div class="route-visualization">
                                <div class="route-line">
                                    <div class="route-progress" id="routeProgress" style="width: 65%"></div>
                                </div>
                                <div class="route-points">
                                    <div class="route-point start active">
                                        <div class="point-marker">
                                            <span class="marker-icon">üè™</span>
                                        </div>
                                        <div class="point-info">
                                            <div class="point-label">Pickup</div>
                                            <div class="point-address">Toko Serba Ada</div>
                                        </div>
                                    </div>
                                    <div class="route-point end">
                                        <div class="point-marker">
                                            <span class="marker-icon">üè†</span>
                                        </div>
                                        <div class="point-info">
                                            <div class="point-label">Tujuan</div>
                                            <div class="point-address">Jl. Sudirman No. 123</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="current-position">
                                    <div class="courier-marker">
                                        <span class="marker-icon">üõµ</span>
                                        <div class="pulse-ring"></div>
                                    </div>
                                    <div class="position-label">Posisi Anda</div>
                                </div>
                            </div>
                            
                            <div class="delivery-details">
                                <div class="detail-row">
                                    <div class="detail-item">
                                        <span class="detail-label">Jarak Tersisa</span>
                                        <span class="detail-value">1.2 km</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Estimasi</span>
                                        <span class="detail-value">8 menit</span>
                                    </div>
                                </div>
                                <div class="detail-row">
                                    <div class="detail-item">
                                        <span class="detail-label">Pembayaran</span>
                                        <span class="detail-value highlight">Rp 45.000</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="delivery-actions">
                                <button class="action-btn primary" onclick="showPage('active-delivery')">
                                    <span class="btn-icon">üìç</span>
                                    LIHAT DETAIL
                                </button>
                                <button class="action-btn secondary" onclick="showChatModal('ORD1001')">
                                    <span class="btn-icon">üí¨</span>
                                    CHAT
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions-section">
                        <div class="section-header">
                            <div class="section-title">Aksi Cepat</div>
                        </div>
                        <div class="actions-grid">
                            <div class="action-card" onclick="loadOrdersFromBackend()">
                                <div class="action-icon refresh">üîÑ</div>
                                <div class="action-text">Refresh Pesanan</div>
                            </div>
                            <div class="action-card" onclick="showNotification('Fitur sedang dikembangkan', 'info')">
                                <div class="action-icon map">üó∫Ô∏è</div>
                                <div class="action-text">Lihat Peta</div>
                            </div>
                            <div class="action-card" onclick="showNotification('Fitur sedang dikembangkan', 'info')">
                                <div class="action-icon earnings">üí∞</div>
                                <div class="action-text">Cek Penghasilan</div>
                            </div>
                            <div class="action-card" onclick="showNotification('Fitur sedang dikembangan', 'info')">
                                <div class="action-icon support">üÜò</div>
                                <div class="action-text">Bantuan</div>
                            </div>
                        </div>
                    </div>

                    <!-- New Jobs Preview -->
                    <div class="jobs-preview-section">
                        <div class="section-header">
                            <div class="section-title">Pesanan Baru</div>
                            <a href="#" class="see-all" onclick="showPage('jobs'); return false;">
                                Lihat Semua
                                <span class="badge" id="jobsBadge">3</span>
                            </a>
                        </div>
                        <div class="jobs-preview" id="jobsPreviewList">
                            <div class="job-preview-card urgent">
                                <div class="job-preview-header">
                                    <div class="job-meta">
                                        <span class="job-preview-id">#ORD1005</span>
                                        <span class="job-time">5 menit lalu</span>
                                    </div>
                                    <span class="job-preview-badge urgent">URGENT</span>
                                </div>
                                <div class="job-preview-route">
                                    <div class="route-from">
                                        <span class="route-icon">üè™</span>
                                        <span class="route-text">Restoran Cepat Saji</span>
                                    </div>
                                    <span class="route-arrow">‚Üí</span>
                                    <div class="route-to">
                                        <span class="route-icon">üè†</span>
                                        <span class="route-text">Apartemen Green Park</span>
                                    </div>
                                </div>
                                <div class="job-preview-details">
                                    <div class="detail">
                                        <span class="detail-label">Jarak:</span>
                                        <span class="detail-value">2.3 km</span>
                                    </div>
                                    <div class="detail">
                                        <span class="detail-label">Estimasi:</span>
                                        <span class="detail-value">15 menit</span>
                                    </div>
                                </div>
                                <div class="job-preview-footer">
                                    <span class="job-preview-price">Rp 38.000</span>
                                    <button class="view-job-btn" onclick="showPage('jobs')">Ambil</button>
                                </div>
                            </div>
                            
                            <div class="job-preview-card">
                                <div class="job-preview-header">
                                    <div class="job-meta">
                                        <span class="job-preview-id">#ORD1004</span>
                                        <span class="job-time">12 menit lalu</span>
                                    </div>
                                    <span class="job-preview-badge">STANDARD</span>
                                </div>
                                <div class="job-preview-route">
                                    <div class="route-from">
                                        <span class="route-icon">üè™</span>
                                        <span class="route-text">Toko Baju A</span>
                                    </div>
                                    <span class="route-arrow">‚Üí</span>
                                    <div class="route-to">
                                        <span class="route-icon">üè†</span>
                                        <span class="route-text">Perumahan Taman Asri</span>
                                    </div>
                                </div>
                                <div class="job-preview-details">
                                    <div class="detail">
                                        <span class="detail-label">Jarak:</span>
                                        <span class="detail-value">4.1 km</span>
                                    </div>
                                    <div class="detail">
                                        <span class="detail-label">Estimasi:</span>
                                        <span class="detail-value">22 menit</span>
                                    </div>
                                </div>
                                <div class="job-preview-footer">
                                    <span class="job-preview-price">Rp 52.000</span>
                                    <button class="view-job-btn" onclick="showPage('jobs')">Ambil</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Performance Insights -->
                    <div class="performance-insights">
                        <div class="section-header">
                            <div class="section-title">Insight Performa</div>
                        </div>
                        <div class="insights-grid">
                            <div class="insight-card">
                                <div class="insight-icon">üöÄ</div>
                                <div class="insight-content">
                                    <div class="insight-title">Performa Terbaik</div>
                                    <div class="insight-desc">Rating 5.0 dalam 7 hari terakhir</div>
                                </div>
                            </div>
                            <div class="insight-card">
                                <div class="insight-icon">üéØ</div>
                                <div class="insight-content">
                                    <div class="insight-title">Target Harian</div>
                                    <div class="insight-desc">15/20 pengiriman terselesaikan</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Jobs Section -->
            <section id="jobs" class="page">
                <div class="page-header">
                    <h2>Pesanan Baru</h2>
                    <div class="jobs-count" id="jobsCount">0 pesanan</div>
                </div>
                <div class="main-content">
                    <div class="jobs-list" id="jobsList">
                        <!-- Jobs will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Active Delivery Section -->
            <section id="active-delivery" class="page">
                <div class="page-header">
                    <h2>Pengiriman Aktif</h2>
                </div>
                <div class="main-content delivery-content">
                    <div class="delivery-card" id="fullDeliveryCard">
                        <div class="no-data">Anda tidak sedang dalam pengiriman aktif.</div>
                    </div>
                    <div class="delivery-actions" id="deliveryActions" style="display: none;">
                        <button class="action-btn primary" onclick="completeDelivery()">
                            <span class="btn-icon">‚úÖ</span>
                            SELESAIKAN PENGIRIMAN
                        </button>
                        <button class="action-btn secondary" onclick="showChatModal(currentChatJobId || 'ORD1001')">
                            <span class="btn-icon">üí¨</span>
                            CHAT CUSTOMER
                        </button>
                    </div>
                </div>
            </section>

            <!-- Earnings Section -->
            <section id="earnings" class="page">
                <div class="page-header">
                    <h2>Penghasilan</h2>
                </div>
                <div class="main-content earnings-content">
                    <div class="earnings-summary">
                        <div class="summary-card">
                            <div class="summary-icon">üí∞</div>
                            <div class="summary-content">
                                <div class="summary-value" id="totalEarnings">Rp 0</div>
                                <div class="summary-label">Total Penghasilan Bulan Ini</div>
                            </div>
                        </div>
                    </div>
                    <div class="section-title">Riwayat Penghasilan</div>
                    <div class="earnings-list" id="earningsList">
                        <!-- Earnings will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- History Section -->
            <section id="history" class="page">
                <div class="page-header">
                    <h2>Riwayat Pengiriman</h2>
                </div>
                <div class="main-content history-content">
                    <div class="filter-options">
                        <select id="historyFilter" onchange="loadHistory()">
                            <option value="all">Semua Status</option>
                            <option value="completed">Selesai</option>
                            <option value="cancelled">Dibatalkan</option>
                        </select>
                    </div>
                    <div class="history-list" id="historyList">
                        <!-- History will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Performance Section -->
            <section id="performance" class="page">
                <div class="page-header">
                    <h2>Performa</h2>
                </div>
                <div class="main-content">
                    <div class="no-data">Fitur performa sedang dalam pengembangan.</div>
                </div>
            </section>
            
            <!-- Profile Section -->
            <section id="profile" class="page">
                <div class="page-header">
                    <h2>Profil Saya</h2>
                    <button class="edit-profile-btn" onclick="showNotification('Simulasi edit profil', 'info')">Edit Profil</button>
                </div>
                <div class="main-content profile-content">
                    <div class="profile-card">
                        <div class="profile-header">
                            <div class="profile-avatar-container">
                                <div class="profile-avatar">üö¥</div>
                                <div class="profile-badge">‚≠ê Premium</div>
                            </div>
                            <div class="profile-info">
                                <h3>Kurir PasarKilat 001</h3>
                                <p class="profile-id">ID: COU001</p>
                                <div class="status-indicator">
                                    <div class="status-dot online"></div>
                                    <span class="status-text">Aktif</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="profile-stats">
                            <div class="stat-item">
                                <div class="stat-value">4.9</div>
                                <div class="stat-label">Rating</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">1,234</div>
                                <div class="stat-label">Pengiriman</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">98%</div>
                                <div class="stat-label">Kepuasan</div>
                            </div>
                        </div>
                        
                        <div class="profile-details">
                            <div class="detail-section">
                                <h4 class="section-title">Informasi Pribadi</h4>
                                <div class="detail-item">
                                    <span class="detail-icon">üìß</span>
                                    <div class="detail-content">
                                        <div class="detail-label">Email</div>
                                        <div class="detail-value">kurir@pasarkilat.com</div>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-icon">üì±</span>
                                    <div class="detail-content">
                                        <div class="detail-label">Telepon</div>
                                        <div class="detail-value">+62 812-3456-7890</div>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-icon">üìç</span>
                                    <div class="detail-content">
                                        <div class="detail-label">Wilayah</div>
                                        <div class="detail-value">Jakarta Pusat</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <h4 class="section-title">Informasi Akun</h4>
                                <div class="detail-item">
                                    <span class="detail-icon">üìÖ</span>
                                    <div class="detail-content">
                                        <div class="detail-label">Bergabung</div>
                                        <div class="detail-value">15 Januari 2024</div>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-icon">üõµ</span>
                                    <div class="detail-content">
                                        <div class="detail-label">Kendaraan</div>
                                        <div class="detail-value">Motor Matic</div>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-icon">‚è±Ô∏è</span>
                                    <div class="detail-content">
                                        <div class="detail-label">Waktu Online</div>
                                        <div class="detail-value">156 jam</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="profile-actions">
                            <button class="action-btn primary" onclick="showNotification('Simulasi ganti foto', 'info')">
                                <span class="btn-icon">üì∑</span>
                                Ganti Foto Profil
                            </button>
                            <button class="action-btn secondary" onclick="showNotification('Simulasi verifikasi', 'info')">
                                <span class="btn-icon">‚úÖ</span>
                                Verifikasi Akun
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Settings Section -->
            <section id="settings" class="page">
                <div class="page-header">
                    <h2>Pengaturan</h2>
                </div>
                <div class="main-content settings-content">
                    <div class="no-data">Pengaturan belum tersedia di versi ini.</div>
                </div>
            </section>
            
            <!-- Help Section -->
            <section id="help" class="page">
                <div class="page-header">
                    <h2>Bantuan & Support</h2>
                </div>
                <div class="main-content help-content">
                    <div class="section-title">Hubungi Kami</div>
                    <div class="contact-options">
                        <button class="contact-btn" onclick="showNotification('Simulasi Call Support', 'info')">
                            <span class="contact-icon">üìû</span>
                            <div class="contact-text">
                                <div class="contact-title">Telepon Customer Service</div>
                                <div class="contact-subtitle">Respons cepat untuk masalah mendesak</div>
                            </div>
                        </button>
                        <button class="contact-btn" onclick="showNotification('Simulasi Chat Support', 'info')">
                            <span class="contact-icon">üí¨</span>
                            <div class="contact-text">
                                <div class="contact-title">Live Chat Support</div>
                                <div class="contact-subtitle">Bantuan melalui pesan dalam aplikasi</div>
                            </div>
                        </button>
                    </div>
                </div>
            </section>

        </main>
        
        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="#" class="nav-item active" data-page="dashboard"><span class="nav-icon">üè†</span><span class="nav-label">Home</span></a>
            <a href="#" class="nav-item" data-page="jobs"><span class="nav-icon">üì¶</span><span class="nav-label">Jobs</span></a>
            <a href="#" class="nav-item" data-page="active-delivery"><span class="nav-icon">üìç</span><span class="nav-label">Antar</span></a>
            <a href="#" class="nav-item" data-page="earnings"><span class="nav-icon">üí∞</span><span class="nav-label">Gaji</span></a>
            <a href="#" class="nav-item" data-page="profile"><span class="nav-icon">üë§</span><span class="nav-label">Saya</span></a>
        </nav>

        <!-- Notification Container -->
        <div id="notificationContainer"></div>

        <!-- QR Code Modal -->
        <div class="modal-overlay" id="qrCodeModal">
            <div class="modal-content">
                <button class="close-modal" onclick="closeQRCodeModal()">‚úï</button>
                <h3>Hubungkan WhatsApp</h3>
                <p>Scan QR code di bawah ini menggunakan aplikasi WhatsApp Anda.</p>
                <div class="qr-container">
                    <img id="qrCodeImage" src="https://via.placeholder.com/256?text=LOADING+QR" alt="QR Code">
                </div>
                <div class="qr-status" id="qrStatusText">Menunggu QR Code dari server...</div>
            </div>
        </div>

        <!-- Chat Modal -->
        <div class="chat-modal" id="chatModal">
            <div class="chat-modal-content">
                <div class="chat-header">
                    <div class="chat-customer-info">
                        <div class="chat-avatar">üë§</div>
                        <div class="chat-details">
                            <div class="chat-name">Customer #<span id="chatJobId"></span></div>
                            <div class="chat-status whatsapp-connected">Online</div>
                        </div>
                    </div>
                    <button class="close-chat" onclick="closeChatModal()">‚úï</button>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="message-item received">
                        <div class="message-bubble">Halo kurir, paket saya sudah dekat?</div>
                        <div class="message-footer">
                            <span class="message-time">10:00</span>
                        </div>
                    </div>
                    <div class="message-item sent">
                        <div class="message-bubble">Selamat siang, ya sebentar lagi sampai. Saya sedang di jalan.</div>
                        <div class="message-footer">
                            <span class="message-time">10:02</span>
                            <span class="message-status read">‚úì‚úì</span>
                        </div>
                    </div>
                </div>
                <div class="chat-input-area">
                    <input type="text" placeholder="Ketik pesan..." id="chatInput">
                    <button onclick="sendChatMessage()">Kirim</button>
                </div>
            </div>
        </div>
        
    </div>

    <!-- Scripts -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="courier-app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            initCourierApp();
            connectWebSocket();
            // Load orders dari backend (atau simulasi) setelah delay singkat
            setTimeout(() => {
                loadOrdersFromBackend();
            }, 500); 
            updateActiveDeliveryUI();
        });
    </script>
</body>
</html>